<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Exploration Target</title>

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(draw);

    async function draw() {
      const csvUrl =
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHkysTN6roFag5cFJv97rmXIsO9vKLKaAXmJxbeAD0v4klws329T8nwBI1ftUFKvrukkvLYM9vPysK/pub?gid=1283363545&single=true&output=csv';

      const res = await fetch(csvUrl);
      const csv = await res.text();
      const rows = csv.trim().split('\n').slice(1);

      const data = new google.visualization.DataTable();

      // Eixo X
      data.addColumn('number', 'Measured + Indicated');

      // Séries
      data.addColumn('number', 'Measured + Indicated');
      data.addColumn('number', 'P+P / M+I');

      // Tooltip HTML
      data.addColumn({ type: 'string', role: 'tooltip', p: { html: true } });

      // Link (usado no clique)
      data.addColumn({ type: 'string', role: 'annotationText' });

      rows.forEach(r => {
        const c = r.split(',').map(v => v.replace(/"/g, '').trim());

        const name = c[0];
        const mi = parseFloat(c[1]); // 0–1
        const pp = parseFloat(c[2]); // 0–1
        const resources = c[3];
        const ore = c[4];
        const link = c[5];

        if (isNaN(mi)) return;

        const tooltip = `
          <div style="padding:8px">
            <b>${name}</b><br>
            Measured + Indicated: ${(mi * 100).toFixed(1)}%<br>
            P+P / M+I: ${isNaN(pp) ? 'N/A' : (pp * 100).toFixed(1) + '%'}<br>
            Resources: ${resources} Mt<br>
            Ore Type: ${ore}<br>
            <span style="color:#1a73e8">Click to open source</span>
          </div>
        `;

        data.addRow([
          mi,
          mi,
          isNaN(pp) ? null : pp,
          tooltip,
          link
        ]);
      });

      const options = {
        title: 'Exploration Target',
        height: 520,
        pointSize: 8,
        tooltip: { isHtml: true },

        hAxis: {
          title: 'Measured + Indicated (%)',
          minValue: 0,
          maxValue: 1,
          format: 'percent'
        },

        vAxis: {
          title: 'P+P / M+I (%)',
          minValue: 0,
          maxValue: 1,
          format: 'percent'
        },

        series: {
          0: { color: '#1a73e8' }, // azul
          1: { color: '#d93025' }  // vermelho
        }
      };

      const chart = new google.visualization.ScatterChart(
        document.getElementById('chart')
      );

      // Clique funcional
      google.visualization.events.addListener(chart, 'select', () => {
        const sel = chart.getSelection();
        if (!sel.length) return;
        const link = data.getValue(sel[0].row, 4);
        if (link) window.open(link, '_blank');
      });

      chart.draw(data, options);
    }
  </script>
</head>

<body>
  <div id="chart"></div>
</body>
</html>


